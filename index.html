<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Australian Retirement Financial Planner</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .app-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .results-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            color: var(--primary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .btn {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .result-card {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .result-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .result-label {
            font-size: 0.9rem;
            color: var(--dark);
            opacity: 0.8;
        }
        
        .chart-container {
            height: 300px;
            margin: 25px 0;
        }
        
        .recommendations {
            margin-top: 30px;
        }
        
        .recommendation {
            background: var(--light);
            padding: 15px;
            border-left: 4px solid var(--secondary);
            margin-bottom: 15px;
            border-radius: 0 5px 5px 0;
        }
        
        .recommendation.warning {
            border-left-color: var(--warning);
        }
        
        .recommendation.success {
            border-left-color: var(--success);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom-color: var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .hidden {
            display: none;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--dark);
            opacity: 0.7;
            font-size: 0.9rem;
        }
        
        .asset-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 3px solid var(--secondary);
        }
        
        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .remove-asset {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .scenario-comparison {
            margin-top: 30px;
        }
        
        .scenario-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .scenario-tab {
            padding: 8px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .scenario-tab.active {
            border-bottom-color: var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .scenario-content {
            display: none;
        }
        
        .scenario-content.active {
            display: block;
        }
        
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .scenario-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .scenario-age {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        
        .scenario-value {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .super-info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary);
        }
        
        .strategy-section {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary);
        }
        
        .strategy-option {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #e1e8ed;
        }
        
        .tax-impact {
            background: #fff8e1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid var(--warning);
        }
        
        .pension-test {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid var(--success);
        }
        
        .allocation-chart {
            height: 200px;
            margin: 15px 0;
        }
        
        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .allocation-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        
        .allocation-label {
            font-weight: 500;
        }
        
        .allocation-percent {
            font-weight: 600;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Advanced Australian Retirement Financial Planner</h1>
            <p class="subtitle">Comprehensive retirement planning with TTR, downsizing, tax strategies & pension tests</p>
        </header>
        
        <div class="app-container">
            <div class="input-section">
                <h2 class="section-title">Your Financial Information</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="basic">Basic Info</div>
                    <div class="tab" data-tab="partner">Partner</div>
                    <div class="tab" data-tab="super">Super & Assets</div>
                    <div class="tab" data-tab="strategies">Strategies</div>
                    <div class="tab" data-tab="income">Income & Expenses</div>
                </div>
                
                <div class="tab-content active" id="basic-tab">
                    <div class="form-group">
                        <label for="current-age">Your Current Age</label>
                        <input type="number" id="current-age" min="18" max="100" value="52">
                    </div>
                    
                    <div class="form-group">
                        <label for="retirement-age">Your Desired Retirement Age</label>
                        <input type="number" id="retirement-age" min="40" max="100" value="65">
                    </div>
                    
                    <div class="form-group">
                        <label for="life-expectancy">Life Expectancy</label>
                        <select id="life-expectancy">
                            <option value="85">Average (85 years)</option>
                            <option value="90" selected>Above Average (90 years)</option>
                            <option value="95">Longevity (95 years)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="inflation">Expected Annual Inflation (%)</label>
                        <input type="number" id="inflation" min="0" max="10" step="0.1" value="2.5">
                    </div>
                    
                    <div class="form-group">
                        <label for="investment-return">Expected Annual Investment Return (%)</label>
                        <input type="number" id="investment-return" min="0" max="20" step="0.1" value="7">
                    </div>
                </div>
                
                <div class="tab-content" id="partner-tab">
                    <div class="checkbox-group">
                        <input type="checkbox" id="has-partner">
                        <label for="has-partner">I have a partner/spouse</label>
                    </div>
                    
                    <div id="partner-details" class="hidden">
                        <div class="form-group">
                            <label for="partner-age">Partner's Age</label>
                            <input type="number" id="partner-age" min="18" max="100" value="49">
                        </div>
                        
                        <div class="form-group">
                            <label for="partner-retirement-age">Partner's Retirement Age</label>
                            <input type="number" id="partner-retirement-age" min="40" max="100" value="65">
                        </div>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="partner-keep-working" checked>
                            <label for="partner-keep-working">Partner continues working after I retire</label>
                        </div>
                        
                        <div class="form-group">
                            <label for="partner-income">Partner's Annual Income</label>
                            <input type="number" id="partner-income" min="0" value="70000">
                        </div>
                        
                        <div class="form-group">
                            <label for="partner-super">Partner's Super Balance</label>
                            <input type="number" id="partner-super" min="0" value="150000">
                        </div>
                        
                        <div class="form-group">
                            <label for="partner-contribution">Partner's Annual Super Contribution</label>
                            <input type="number" id="partner-contribution" min="0" value="8500">
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="super-tab">
                    <div class="super-info">
                        <h4>Australian Superannuation</h4>
                        <p>Your employer contributes 11% of your earnings to super. Additional contributions may be tax-deductible.</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="current-super">Your Current Super Balance</label>
                        <input type="number" id="current-super" min="0" value="380000">
                    </div>
                    
                    <div class="form-group">
                        <label for="annual-contribution">Your Annual Super Contribution (incl. employer)</label>
                        <input type="number" id="annual-contribution" min="0" value="18000">
                    </div>
                    
                    <div class="form-group">
                        <label for="salary-sacrifice">Additional Salary Sacrifice (Annual)</label>
                        <input type="number" id="salary-sacrifice" min="0" value="5000">
                    </div>
                    
                    <h3>Property Assets</h3>
                    
                    <div class="form-group">
                        <label for="primary-residence-value">Primary Residence Value</label>
                        <input type="number" id="primary-residence-value" min="0" value="850000">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="consider-downsizing">
                        <label for="consider-downsizing">Considering downsizing primary residence</label>
                    </div>
                    
                    <div id="downsizing-details" class="hidden">
                        <div class="form-group">
                            <label for="downsize-value">Expected Downsized Property Value</label>
                            <input type="number" id="downsize-value" min="0" value="600000">
                        </div>
                        
                        <div class="form-group">
                            <label for="downsize-age">Planned Downsizing Age</label>
                            <input type="number" id="downsize-age" min="55" max="85" value="70">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="investment-properties">Investment Properties Value</label>
                        <input type="number" id="investment-properties" min="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="other-assets">Other Assets Value (Shares, Savings, etc.)</label>
                        <input type="number" id="other-assets" min="0" value="75000">
                    </div>
                </div>
                
                <div class="tab-content" id="strategies-tab">
                    <div class="strategy-section">
                        <h3>Transition to Retirement (TTR) Strategy</h3>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="consider-ttr">
                            <label for="consider-ttr">Consider Transition to Retirement strategy</label>
                        </div>
                        
                        <div id="ttr-details" class="hidden">
                            <div class="form-group">
                                <label for="ttr-start-age">Start TTR at Age</label>
                                <input type="number" id="ttr-start-age" min="55" max="75" value="60">
                            </div>
                            
                            <div class="form-group">
                                <label for="ttr-income">Desired TTR Income (% of salary)</label>
                                <input type="number" id="ttr-income" min="10" max="100" value="50">
                            </div>
                            
                            <div class="form-group">
                                <label for="ttr-salary-sacrifice">Additional Salary Sacrifice during TTR (%)</label>
                                <input type="number" id="ttr-salary-sacrifice" min="0" max="50" value="15">
                            </div>
                        </div>
                    </div>
                    
                    <div class="strategy-section">
                        <h3>Investment Strategy</h3>
                        
                        <div class="form-group">
                            <label for="risk-profile">Your Risk Profile</label>
                            <select id="risk-profile">
                                <option value="conservative">Conservative</option>
                                <option value="moderate" selected>Moderate</option>
                                <option value="balanced">Balanced</option>
                                <option value="growth">Growth</option>
                                <option value="high-growth">High Growth</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="current-allocation">Current Super Asset Allocation</label>
                            <select id="current-allocation">
                                <option value="conservative">Conservative (30% growth)</option>
                                <option value="moderate">Moderate (50% growth)</option>
                                <option value="balanced" selected>Balanced (70% growth)</option>
                                <option value="growth">Growth (85% growth)</option>
                                <option value="high-growth">High Growth (100% growth)</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="income-tab">
                    <div class="form-group">
                        <label for="current-income">Your Current Annual Income</label>
                        <input type="number" id="current-income" min="0" value="105000">
                    </div>
                    
                    <div class="form-group">
                        <label for="current-expenses">Current Annual Expenses</label>
                        <input type="number" id="current-expenses" min="0" value="75000">
                    </div>
                    
                    <div class="form-group">
                        <label for="retirement-expenses">Expected Retirement Expenses (% of Current)</label>
                        <input type="number" id="retirement-expenses" min="50" max="150" value="75">
                    </div>
                    
                    <div class="form-group">
                        <label for="healthcare-costs">Expected Annual Healthcare Costs in Retirement</label>
                        <input type="number" id="healthcare-costs" min="0" value="8000">
                    </div>
                </div>
                
                <button id="calculate-btn" class="btn btn-block">Calculate Retirement Plan</button>
                <button id="save-btn" class="btn btn-success btn-block">Save Data Locally</button>
                <button id="load-btn" class="btn btn-warning btn-block">Load Saved Data</button>
            </div>
            
            <div class="results-section">
                <h2 class="section-title">Your Retirement Plan</h2>
                
                <div id="results-placeholder">
                    <p>Enter your financial information and click "Calculate Retirement Plan" to see your personalized retirement strategy.</p>
                </div>
                
                <div id="results-content" class="hidden">
                    <div class="scenario-comparison">
                        <h3>Retirement Scenarios</h3>
                        <div class="scenario-tabs">
                            <div class="scenario-tab active" data-scenario="55">Age 55</div>
                            <div class="scenario-tab" data-scenario="60">Age 60</div>
                            <div class="scenario-tab" data-scenario="65">Age 65</div>
                            <div class="scenario-tab" data-scenario="70">Age 70</div>
                        </div>
                        
                        <div class="scenario-content active" id="scenario-55">
                            <div class="scenario-grid">
                                <div class="scenario-card">
                                    <div class="scenario-age">Age 55</div>
                                    <div class="result-label">Years to Retirement</div>
                                    <div class="scenario-value" id="scenario-55-years">3</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Projected Super</div>
                                    <div class="scenario-value" id="scenario-55-super">$450,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Annual Retirement Income</div>
                                    <div class="scenario-value" id="scenario-55-income">$42,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Retirement Shortfall</div>
                                    <div class="scenario-value" id="scenario-55-shortfall">$18,000</div>
                                </div>
                            </div>
                            <div class="recommendation warning">
                                <h4>Age 55 Retirement Considerations</h4>
                                <p>Retiring at 55 would require accessing your super through a transition to retirement pension. You may face a significant income shortfall without additional savings or part-time work.</p>
                            </div>
                        </div>
                        
                        <div class="scenario-content" id="scenario-60">
                            <div class="scenario-grid">
                                <div class="scenario-card">
                                    <div class="scenario-age">Age 60</div>
                                    <div class="result-label">Years to Retirement</div>
                                    <div class="scenario-value" id="scenario-60-years">8</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Projected Super</div>
                                    <div class="scenario-value" id="scenario-60-super">$680,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Annual Retirement Income</div>
                                    <div class="scenario-value" id="scenario-60-income">$54,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Retirement Shortfall</div>
                                    <div class="scenario-value" id="scenario-60-shortfall">$6,000</div>
                                </div>
                            </div>
                            <div class="recommendation">
                                <h4>Age 60 Retirement Considerations</h4>
                                <p>At age 60, you can access your super tax-free. Your projected income is closer to your needs, but you may still need to supplement with part-time work or reduce expenses.</p>
                            </div>
                        </div>
                        
                        <div class="scenario-content" id="scenario-65">
                            <div class="scenario-grid">
                                <div class="scenario-card">
                                    <div class="scenario-age">Age 65</div>
                                    <div class="result-label">Years to Retirement</div>
                                    <div class="scenario-value" id="scenario-65-years">13</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Projected Super</div>
                                    <div class="scenario-value" id="scenario-65-super">$950,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Annual Retirement Income</div>
                                    <div class="scenario-value" id="scenario-65-income">$68,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Retirement Surplus</div>
                                    <div class="scenario-value" id="scenario-65-surplus">$8,000</div>
                                </div>
                            </div>
                            <div class="recommendation success">
                                <h4>Age 65 Retirement Considerations</h4>
                                <p>At age 65, you reach Age Pension eligibility and your super has more time to grow. This scenario shows a comfortable retirement with potential for surplus income.</p>
                            </div>
                        </div>
                        
                        <div class="scenario-content" id="scenario-70">
                            <div class="scenario-grid">
                                <div class="scenario-card">
                                    <div class="scenario-age">Age 70</div>
                                    <div class="result-label">Years to Retirement</div>
                                    <div class="scenario-value" id="scenario-70-years">18</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Projected Super</div>
                                    <div class="scenario-value" id="scenario-70-super">$1,250,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Annual Retirement Income</div>
                                    <div class="scenario-value" id="scenario-70-income">$82,000</div>
                                </div>
                                <div class="scenario-card">
                                    <div class="result-label">Retirement Surplus</div>
                                    <div class="scenario-value" id="scenario-70-surplus">$22,000</div>
                                </div>
                            </div>
                            <div class="recommendation success">
                                <h4>Age 70 Retirement Considerations</h4>
                                <p>Working until 70 maximizes your super balance and minimizes retirement years. This provides the highest retirement income but means fewer years to enjoy retirement.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="strategy-section">
                        <h3>Transition to Retirement Analysis</h3>
                        <div id="ttr-analysis">
                            <!-- TTR analysis will be populated here -->
                        </div>
                    </div>
                    
                    <div class="strategy-section">
                        <h3>Downsizing Strategy Analysis</h3>
                        <div id="downsizing-analysis">
                            <!-- Downsizing analysis will be populated here -->
                        </div>
                    </div>
                    
                    <div class="strategy-section">
                        <h3>Age Pension Eligibility</h3>
                        <div class="pension-test" id="pension-test">
                            <!-- Age Pension test results will be populated here -->
                        </div>
                    </div>
                    
                    <div class="strategy-section">
                        <h3>Tax Considerations in Retirement</h3>
                        <div class="tax-impact" id="tax-analysis">
                            <!-- Tax analysis will be populated here -->
                        </div>
                    </div>
                    
                    <div class="strategy-section">
                        <h3>Recommended Asset Allocation</h3>
                        <div class="allocation-chart">
                            <canvas id="allocation-chart"></canvas>
                        </div>
                        <div id="allocation-recommendation">
                            <!-- Allocation recommendation will be populated here -->
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="retirement-chart"></canvas>
                    </div>
                    
                    <div class="recommendations">
                        <h3 class="section-title">Strategic Recommendations</h3>
                        <div id="recommendations-list">
                            <!-- Recommendations will be populated here -->
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="export-pdf" class="btn">Export as PDF</button>
                        <button id="print-plan" class="btn">Print Plan</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>This retirement planner is for informational purposes only. Consult with a qualified financial advisor for personalized advice.</p>
            <p>All data is stored locally on your device and is not transmitted to any server.</p>
            <p>Australian Superannuation and Age Pension rules are subject to change. Verify current regulations with the ATO and Services Australia.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // DOM Elements
        const calculateBtn = document.getElementById('calculate-btn');
        const saveBtn = document.getElementById('save-btn');
        const loadBtn = document.getElementById('load-btn');
        const exportPdfBtn = document.getElementById('export-pdf');
        const printPlanBtn = document.getElementById('print-plan');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const resultsPlaceholder = document.getElementById('results-placeholder');
        const resultsContent = document.getElementById('results-content');
        const hasPartnerCheckbox = document.getElementById('has-partner');
        const partnerDetails = document.getElementById('partner-details');
        const partnerKeepWorking = document.getElementById('partner-keep-working');
        const considerDownsizing = document.getElementById('consider-downsizing');
        const downsizingDetails = document.getElementById('downsizing-details');
        const considerTTR = document.getElementById('consider-ttr');
        const ttrDetails = document.getElementById('ttr-details');
        const scenarioTabs = document.querySelectorAll('.scenario-tab');
        const scenarioContents = document.querySelectorAll('.scenario-content');
        
        // Input fields
        const currentAge = document.getElementById('current-age');
        const retirementAge = document.getElementById('retirement-age');
        const lifeExpectancy = document.getElementById('life-expectancy');
        const inflation = document.getElementById('inflation');
        const investmentReturn = document.getElementById('investment-return');
        const currentSuper = document.getElementById('current-super');
        const annualContribution = document.getElementById('annual-contribution');
        const salarySacrifice = document.getElementById('salary-sacrifice');
        const currentIncome = document.getElementById('current-income');
        const currentExpenses = document.getElementById('current-expenses');
        const retirementExpenses = document.getElementById('retirement-expenses');
        const healthcareCosts = document.getElementById('healthcare-costs');
        
        // Partner fields
        const partnerAge = document.getElementById('partner-age');
        const partnerRetirementAge = document.getElementById('partner-retirement-age');
        const partnerIncome = document.getElementById('partner-income');
        const partnerSuper = document.getElementById('partner-super');
        const partnerContribution = document.getElementById('partner-contribution');
        
        // Strategy fields
        const considerDownsizingCheckbox = document.getElementById('consider-downsizing');
        const downsizeValue = document.getElementById('downsize-value');
        const downsizeAge = document.getElementById('downsize-age');
        const considerTTRCheckbox = document.getElementById('consider-ttr');
        const ttrStartAge = document.getElementById('ttr-start-age');
        const ttrIncome = document.getElementById('ttr-income');
        const ttrSalarySacrifice = document.getElementById('ttr-salary-sacrifice');
        const riskProfile = document.getElementById('risk-profile');
        const currentAllocation = document.getElementById('current-allocation');
        
        // Asset fields
        const investmentProperties = document.getElementById('investment-properties');
        const primaryResidenceValue = document.getElementById('primary-residence-value');
        const otherAssets = document.getElementById('other-assets');
        
        // Result fields
        const scenario55Years = document.getElementById('scenario-55-years');
        const scenario55Super = document.getElementById('scenario-55-super');
        const scenario55Income = document.getElementById('scenario-55-income');
        const scenario55Shortfall = document.getElementById('scenario-55-shortfall');
        
        const scenario60Years = document.getElementById('scenario-60-years');
        const scenario60Super = document.getElementById('scenario-60-super');
        const scenario60Income = document.getElementById('scenario-60-income');
        const scenario60Shortfall = document.getElementById('scenario-60-shortfall');
        
        const scenario65Years = document.getElementById('scenario-65-years');
        const scenario65Super = document.getElementById('scenario-65-super');
        const scenario65Income = document.getElementById('scenario-65-income');
        const scenario65Surplus = document.getElementById('scenario-65-surplus');
        
        const scenario70Years = document.getElementById('scenario-70-years');
        const scenario70Super = document.getElementById('scenario-70-super');
        const scenario70Income = document.getElementById('scenario-70-income');
        const scenario70Surplus = document.getElementById('scenario-70-surplus');
        
        const ttrAnalysis = document.getElementById('ttr-analysis');
        const downsizingAnalysis = document.getElementById('downsizing-analysis');
        const pensionTest = document.getElementById('pension-test');
        const taxAnalysis = document.getElementById('tax-analysis');
        const allocationRecommendation = document.getElementById('allocation-recommendation');
        const recommendationsList = document.getElementById('recommendations-list');
        
        // Chart variables
        let retirementChart;
        let allocationChart;
        
        // Tab functionality
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active tab content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // Scenario tab functionality
        scenarioTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const scenarioId = tab.getAttribute('data-scenario');
                
                // Update active scenario tab
                scenarioTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active scenario content
                scenarioContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `scenario-${scenarioId}`) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // Partner checkbox toggle
        hasPartnerCheckbox.addEventListener('change', function() {
            if (this.checked) {
                partnerDetails.classList.remove('hidden');
            } else {
                partnerDetails.classList.add('hidden');
            }
        });
        
        // Downsizing checkbox toggle
        considerDownsizingCheckbox.addEventListener('change', function() {
            if (this.checked) {
                downsizingDetails.classList.remove('hidden');
            } else {
                downsizingDetails.classList.add('hidden');
            }
        });
        
        // TTR checkbox toggle
        considerTTRCheckbox.addEventListener('change', function() {
            if (this.checked) {
                ttrDetails.classList.remove('hidden');
            } else {
                ttrDetails.classList.add('hidden');
            }
        });
        
        // Calculate retirement plan
        calculateBtn.addEventListener('click', calculateRetirement);
        
        function calculateRetirement() {
            // Get input values
            const age = parseInt(currentAge.value);
            const retireAge = parseInt(retirementAge.value);
            const expectancy = parseInt(lifeExpectancy.value);
            const inflationRate = parseFloat(inflation.value) / 100;
            const returnRate = parseFloat(investmentReturn.value) / 100;
            const superBalance = parseFloat(currentSuper.value);
            const contribution = parseFloat(annualContribution.value) + parseFloat(salarySacrifice.value);
            const income = parseFloat(currentIncome.value);
            const expenses = parseFloat(currentExpenses.value);
            const retirementExpenseRate = parseFloat(retirementExpenses.value) / 100;
            const healthcare = parseFloat(healthcareCosts.value);
            
            // Partner data
            let partnerData = null;
            if (hasPartnerCheckbox.checked) {
                partnerData = {
                    age: parseInt(partnerAge.value),
                    retirementAge: parseInt(partnerRetirementAge.value),
                    keepWorking: partnerKeepWorking.checked,
                    income: parseFloat(partnerIncome.value),
                    super: parseFloat(partnerSuper.value),
                    contribution: parseFloat(partnerContribution.value)
                };
            }
            
            // Strategy data
            const downsizingData = considerDownsizingCheckbox.checked ? {
                planned: true,
                downsizeValue: parseFloat(downsizeValue.value),
                downsizeAge: parseInt(downsizeAge.value)
            } : { planned: false };
            
            const ttrData = considerTTRCheckbox.checked ? {
                planned: true,
                startAge: parseInt(ttrStartAge.value),
                incomePercent: parseFloat(ttrIncome.value) / 100,
                salarySacrificePercent: parseFloat(ttrSalarySacrifice.value) / 100
            } : { planned: false };
            
            // Asset data
            const investmentPropsValue = parseFloat(investmentProperties.value);
            const residenceValue = parseFloat(primaryResidenceValue.value);
            const otherAssetsValue = parseFloat(otherAssets.value);
            
            // Risk profile
            const riskProfileValue = riskProfile.value;
            const currentAllocationValue = currentAllocation.value;
            
            // Calculate retirement scenarios
            calculateScenario(55, age, expectancy, inflationRate, returnRate, superBalance, contribution, 
                            expenses, retirementExpenseRate, healthcare, partnerData, downsizingData, ttrData);
            calculateScenario(60, age, expectancy, inflationRate, returnRate, superBalance, contribution, 
                            expenses, retirementExpenseRate, healthcare, partnerData, downsizingData, ttrData);
            calculateScenario(65, age, expectancy, inflationRate, returnRate, superBalance, contribution, 
                            expenses, retirementExpenseRate, healthcare, partnerData, downsizingData, ttrData);
            calculateScenario(70, age, expectancy, inflationRate, returnRate, superBalance, contribution, 
                            expenses, retirementExpenseRate, healthcare, partnerData, downsizingData, ttrData);
            
            // Generate strategy analyses
            generateTTRAnalysis(age, ttrData, superBalance, income);
            generateDownsizingAnalysis(downsizingData, residenceValue);
            generatePensionTest(superBalance, residenceValue, investmentPropsValue, otherAssetsValue, partnerData);
            generateTaxAnalysis(retireAge, superBalance);
            generateAllocationRecommendation(age, riskProfileValue, currentAllocationValue);
            
            // Generate recommendations
            generateRecommendations(age, retireAge, superBalance, contribution, partnerData, ttrData, downsizingData);
            
            // Generate charts
            generateChart(age, expectancy, returnRate, superBalance, contribution, partnerData);
            generateAllocationChart(riskProfileValue);
            
            // Show results
            resultsPlaceholder.classList.add('hidden');
            resultsContent.classList.remove('hidden');
        }
        
        function calculateScenario(scenarioAge, currentAge, lifeExpectancy, inflationRate, returnRate, 
                                 superBalance, contribution, expenses, retirementExpenseRate, healthcare, 
                                 partnerData, downsizingData, ttrData) {
            const yearsToRetirement = scenarioAge - currentAge;
            const retirementYears = lifeExpectancy - scenarioAge;
            
            // Calculate future super balance
            let projectedSuper = superBalance;
            let ttrImpact = 0;
            
            // Apply TTR strategy if applicable
            if (ttrData.planned && scenarioAge >= ttrData.startAge) {
                const ttrYears = Math.min(yearsToRetirement, scenarioAge - ttrData.startAge);
                const preTTRYears = yearsToRetirement - ttrYears;
                
                // Growth before TTR
                for (let i = 0; i < preTTRYears; i++) {
                    projectedSuper = projectedSuper * (1 + returnRate) + contribution;
                }
                
                // TTR phase
                for (let i = 0; i < ttrYears; i++) {
                    // Withdraw TTR income
                    const ttrWithdrawal = projectedSuper * 0.04; // 4% TTR minimum
                    projectedSuper -= ttrWithdrawal;
                    
                    // Continue growth with reduced contributions (salary sacrifice increases)
                    const ttrContribution = contribution * (1 + ttrData.salarySacrificePercent);
                    projectedSuper = projectedSuper * (1 + returnRate) + ttrContribution;
                    
                    ttrImpact += ttrWithdrawal;
                }
            } else {
                // Standard accumulation
                for (let i = 0; i < yearsToRetirement; i++) {
                    projectedSuper = projectedSuper * (1 + returnRate) + contribution;
                }
            }
            
            // Apply downsizing if applicable
            if (downsizingData.planned && scenarioAge >= downsizingData.downsizeAge) {
                const downsizingProceeds = downsizingData.downsizeValue - residenceValue;
                if (downsizingProceeds > 0) {
                    // Add downsizer contribution to super (up to $300,000 per person)
                    const downsizerContribution = Math.min(300000, downsizingProceeds / 2);
                    projectedSuper += downsizerContribution;
                }
            }
            
            // Add partner's super if applicable and if partner retires at same time or earlier
            if (partnerData && partnerData.retirementAge <= scenarioAge) {
                let partnerProjectedSuper = partnerData.super;
                const partnerYearsToRetirement = scenarioAge - partnerData.age;
                
                for (let i = 0; i < partnerYearsToRetirement; i++) {
                    partnerProjectedSuper = partnerProjectedSuper * (1 + returnRate) + partnerData.contribution;
                }
                
                projectedSuper += partnerProjectedSuper;
            }
            
            // Calculate retirement expenses (adjusted for inflation)
            const retirementExpensesAnnual = (expenses * retirementExpenseRate) + healthcare;
            const futureRetirementExpenses = retirementExpensesAnnual * Math.pow(1 + inflationRate, yearsToRetirement);
            
            // Calculate retirement income (4% withdrawal rule + potential Age Pension)
            const withdrawalRate = 0.04;
            const superIncome = projectedSuper * withdrawalRate;
            
            // Estimate Age Pension based on assets (simplified)
            let agePension = 0;
            const totalAssets = projectedSuper + (investmentPropsValue || 0) + (otherAssets || 0);
            if (totalAssets < 280000) { // Below asset test threshold for couple
                agePension = partnerData ? 40000 : 27000; // Approximate full Age Pension
            } else if (totalAssets < 875000) { // Partial Age Pension range
                agePension = partnerData ? 20000 : 13500; // Approximate partial Age Pension
            }
            
            const totalRetirementIncome = superIncome + agePension;
            
            // Calculate shortfall/surplus
            const shortfall = Math.max(0, futureRetirementExpenses - totalRetirementIncome);
            const surplus = Math.max(0, totalRetirementIncome - futureRetirementExpenses);
            
            // Update scenario display
            const yearsElement = document.getElementById(`scenario-${scenarioAge}-years`);
            const superElement = document.getElementById(`scenario-${scenarioAge}-super`);
            const incomeElement = document.getElementById(`scenario-${scenarioAge}-income`);
            
            if (yearsElement) yearsElement.textContent = yearsToRetirement;
            if (superElement) superElement.textContent = formatCurrency(projectedSuper);
            if (incomeElement) incomeElement.textContent = formatCurrency(totalRetirementIncome);
            
            if (shortfall > 0) {
                const shortfallElement = document.getElementById(`scenario-${scenarioAge}-shortfall`);
                if (shortfallElement) {
                    shortfallElement.textContent = formatCurrency(shortfall);
                    shortfallElement.style.display = 'block';
                }
                
                // Hide surplus element if it exists
                const surplusElement = document.getElementById(`scenario-${scenarioAge}-surplus`);
                if (surplusElement) surplusElement.style.display = 'none';
            } else {
                const surplusElement = document.getElementById(`scenario-${scenarioAge}-surplus`);
                if (surplusElement) {
                    surplusElement.textContent = formatCurrency(surplus);
                    surplusElement.style.display = 'block';
                }
                
                // Hide shortfall element if it exists
                const shortfallElement = document.getElementById(`scenario-${scenarioAge}-shortfall`);
                if (shortfallElement) shortfallElement.style.display = 'none';
            }
            
            return {
                age: scenarioAge,
                yearsToRetirement,
                projectedSuper,
                retirementIncome: totalRetirementIncome,
                shortfall,
                surplus
            };
        }
        
        function generateTTRAnalysis(currentAge, ttrData, superBalance, income) {
            if (!ttrData.planned) {
                ttrAnalysis.innerHTML = `
                    <div class="recommendation">
                        <h4>Transition to Retirement Strategy</h4>
                        <p>You are not currently considering a Transition to Retirement strategy. This strategy can help you:</p>
                        <ul>
                            <li>Reduce working hours while maintaining income</li>
                            <li>Boost super savings through salary sacrifice</li>
                            <li>Smooth the transition into full retirement</li>
                        </ul>
                        <p>Consider enabling TTR in the Strategies tab to see potential benefits.</p>
                    </div>
                `;
                return;
            }
            
            const ttrStartAge = ttrData.startAge;
            const yearsToTTR = ttrStartAge - currentAge;
            const ttrIncome = income * ttrData.incomePercent;
            const salarySacrificeAmount = income * ttrData.salarySacrificePercent;
            
            ttrAnalysis.innerHTML = `
                <div class="strategy-option">
                    <h4>Transition to Retirement Analysis</h4>
                    <div class="scenario-grid">
                        <div class="scenario-card">
                            <div class="result-label">TTR Start Age</div>
                            <div class="scenario-value">${ttrStartAge}</div>
                        </div>
                        <div class="scenario-card">
                            <div class="result-label">Years Until TTR</div>
                            <div class="scenario-value">${yearsToTTR}</div>
                        </div>
                        <div class="scenario-card">
                            <div class="result-label">TTR Income</div>
                            <div class="scenario-value">${formatCurrency(ttrIncome)}</div>
                        </div>
                        <div class="scenario-card">
                            <div class="result-label">Additional Salary Sacrifice</div>
                            <div class="scenario-value">${formatCurrency(salarySacrificeAmount)}</div>
                        </div>
                    </div>
                    <div class="tax-impact">
                        <h5>Tax Benefits</h5>
                        <p>By salary sacrificing ${formatCurrency(salarySacrificeAmount)} annually into super during TTR, you could save approximately ${formatCurrency(salarySacrificeAmount * 0.15)} in tax each year (assuming 32.5% marginal tax rate).</p>
                    </div>
                </div>
            `;
        }
        
        function generateDownsizingAnalysis(downsizingData, residenceValue) {
            if (!downsizingData.planned) {
                downsizingAnalysis.innerHTML = `
                    <div class="recommendation">
                        <h4>Property Downsizing Strategy</h4>
                        <p>You are not currently considering downsizing your primary residence. Downsizing can help you:</p>
                        <ul>
                            <li>Unlock home equity for retirement income</li>
                            <li>Reduce maintenance costs and responsibilities</li>
                            <li>Make a downsizer contribution to super (up to $300,000 per person)</li>
                        </ul>
                        <p>Consider enabling downsizing in the Strategies tab to see potential benefits.</p>
                    </div>
                `;
                return;
            }
            
            const downsizingProceeds = downsizingData.downsizeValue - residenceValue;
            const downsizerContribution = Math.min(300000, Math.max(0, downsizingProceeds / 2));
            
            downsizingAnalysis.innerHTML = `
                <div class="strategy-option">
                    <h4>Downsizing Strategy Analysis</h4>
                    <div class="scenario-grid">
                        <div class="scenario-card">
                            <div class="result-label">Planned Downsizing Age</div>
                            <div class="scenario-value">${downsizingData.downsizeAge}</div>
                        </div>
                        <div class="scenario-card">
                            <div class="result-label">Current Home Value</div>
                            <div class="scenario-value">${formatCurrency(residenceValue)}</div>
                        </div>
                        <div class="scenario-card">
                            <div class="result-label">Downsized Home Value</div>
                            <div class="scenario-value">${formatCurrency(downsizingData.downsizeValue)}</div>
                        </div>
                        <div class="scenario-card">
                            <div class="result-label">Potential Proceeds</div>
                            <div class="scenario-value">${formatCurrency(downsizingProceeds)}</div>
                        </div>
                    </div>
                    <div class="tax-impact">
                        <h5>Downsizer Contribution</h5>
                        <p>You could contribute up to ${formatCurrency(downsizerContribution)} each to super from the sale proceeds, potentially boosting your retirement savings significantly.</p>
                        <p><em>Note: Primary residence is exempt from Age Pension assets test.</em></p>
                    </div>
                </div>
            `;
        }
        
        function generatePensionTest(superBalance, residenceValue, investmentPropsValue, otherAssetsValue, partnerData) {
            const totalAssets = superBalance + investmentPropsValue + otherAssetsValue;
            const hasPartner = partnerData !== null;
            
            // Simplified Age Pension assets test
            let pensionStatus = '';
            let pensionAmount = 0;
            
            if (hasPartner) {
                if (totalAssets < 280000) {
                    pensionStatus = 'Full Age Pension likely';
                    pensionAmount = 40000;
                } else if (totalAssets < 875000) {
                    pensionStatus = 'Partial Age Pension likely';
                    pensionAmount = 20000;
                } else {
                    pensionStatus = 'No Age Pension due to assets';
                    pensionAmount = 0;
                }
            } else {
                if (totalAssets < 200000) {
                    pensionStatus = 'Full Age Pension likely';
                    pensionAmount = 27000;
                } else if (totalAssets < 625000) {
                    pensionStatus = 'Partial Age Pension likely';
                    pensionAmount = 13500;
                } else {
                    pensionStatus = 'No Age Pension due to assets';
                    pensionAmount = 0;
                }
            }
            
            pensionTest.innerHTML = `
                <h4>Age Pension Eligibility Assessment</h4>
                <div class="scenario-grid">
                    <div class="scenario-card">
                        <div class="result-label">Assessable Assets</div>
                        <div class="scenario-value">${formatCurrency(totalAssets)}</div>
                    </div>
                    <div class="scenario-card">
                        <div class="result-label">Home Exemption</div>
                        <div class="scenario-value">${formatCurrency(residenceValue)}</div>
                    </div>
                    <div class="scenario-card">
                        <div class="result-label">Pension Status</div>
                        <div class="scenario-value">${pensionStatus}</div>
                    </div>
                    <div class="scenario-card">
                        <div class="result-label">Estimated Pension</div>
                        <div class="scenario-value">${formatCurrency(pensionAmount)}</div>
                    </div>
                </div>
                <p><em>Based on current asset levels. Age Pension also depends on income tests and eligibility age requirements.</em></p>
            `;
        }
        
        function generateTaxAnalysis(retireAge, superBalance) {
            let taxStatus = '';
            let taxExplanation = '';
            
            if (retireAge < 60) {
                taxStatus = 'Taxable super income';
                taxExplanation = 'If you retire before age 60, your super income stream payments may be taxable, with a 15% tax offset. Lump sum withdrawals may have tax-free and taxable components.';
            } else {
                taxStatus = 'Tax-free super income';
                taxExplanation = 'From age 60, super income stream payments and lump sum withdrawals are generally tax-free when received from a taxed super fund.';
            }
            
            taxAnalysis.innerHTML = `
                <h4>Retirement Phase Tax Considerations</h4>
                <div class="scenario-grid">
                    <div class="scenario-card">
                        <div class="result-label">Planned Retirement Age</div>
                        <div class="scenario-value">${retireAge}</div>
                    </div>
                    <div class="scenario-card">
                        <div class="result-label">Tax Status</div>
                        <div class="scenario-value">${taxStatus}</div>
                    </div>
                </div>
                <p>${taxExplanation}</p>
                <p><strong>Other considerations:</strong></p>
                <ul>
                    <li>Super earnings in retirement phase are tax-free</li>
                    <li>Age Pension payments are tax-free</li>
                    <li>Other investment income may be taxable</li>
                    <li>Consider the transfer balance cap ($1.9 million) for retirement phase super</li>
                </ul>
            `;
        }
        
        function generateAllocationRecommendation(currentAge, riskProfile, currentAllocation) {
            // Determine recommended allocation based on age and risk profile
            let recommendedAllocation = {};
            let recommendationText = '';
            
            if (currentAge < 50) {
                if (riskProfile === 'conservative') {
                    recommendedAllocation = { growth: 40, defensive: 60 };
                    recommendationText = 'Given your conservative risk profile but younger age, we recommend a slightly higher growth allocation to maximize long-term returns.';
                } else if (riskProfile === 'moderate') {
                    recommendedAllocation = { growth: 60, defensive: 40 };
                    recommendationText = 'A balanced growth approach suits your moderate risk tolerance and time horizon until retirement.';
                } else {
                    recommendedAllocation = { growth: 80, defensive: 20 };
                    recommendationText = 'With your growth-oriented risk profile and time until retirement, a high growth allocation is appropriate.';
                }
            } else if (currentAge < 60) {
                if (riskProfile === 'conservative') {
                    recommendedAllocation = { growth: 30, defensive: 70 };
                    recommendationText = 'A conservative allocation is appropriate as you approach retirement, focusing on capital preservation.';
                } else if (riskProfile === 'moderate') {
                    recommendedAllocation = { growth: 50, defensive: 50 };
                    recommendationText = 'A moderate allocation balances growth potential with risk management as retirement approaches.';
                } else {
                    recommendedAllocation = { growth: 65, defensive: 35 };
                    recommendationText = 'A growth-oriented allocation can still be appropriate, but with increased defensive assets for stability.';
                }
            } else {
                // In retirement
                if (riskProfile === 'conservative') {
                    recommendedAllocation = { growth: 20, defensive: 80 };
                    recommendationText = 'In retirement, a conservative allocation focuses on income generation and capital preservation.';
                } else if (riskProfile === 'moderate') {
                    recommendedAllocation = { growth: 40, defensive: 60 };
                    recommendationText = 'A moderate allocation in retirement provides some growth while prioritizing stability and income.';
                } else {
                    recommendedAllocation = { growth: 50, defensive: 50 };
                    recommendationText = 'Even with a growth orientation in retirement, maintaining significant defensive assets is important for sequence risk.';
                }
            }
            
            allocationRecommendation.innerHTML = `
                <h4>Asset Allocation Strategy</h4>
                <p>${recommendationText}</p>
                <div class="allocation-item">
                    <span class="allocation-label">Growth Assets (Shares, Property)</span>
                    <span class="allocation-percent">${recommendedAllocation.growth}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${recommendedAllocation.growth}%; background-color: #3498db;"></div>
                </div>
                <div class="allocation-item">
                    <span class="allocation-label">Defensive Assets (Cash, Bonds)</span>
                    <span class="allocation-percent">${recommendedAllocation.defensive}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${recommendedAllocation.defensive}%; background-color: #2ecc71;"></div>
                </div>
                <p><em>Consider reviewing your super investment option to align with this recommended allocation.</em></p>
            `;
            
            return recommendedAllocation;
        }
        
        function generateAllocationChart(riskProfile) {
            const ctx = document.getElementById('allocation-chart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (allocationChart) {
                allocationChart.destroy();
            }
            
            // Define allocations based on risk profile
            let growth, defensive;
            
            switch(riskProfile) {
                case 'conservative':
                    growth = 30;
                    defensive = 70;
                    break;
                case 'moderate':
                    growth = 50;
                    defensive = 50;
                    break;
                case 'balanced':
                    growth = 70;
                    defensive = 30;
                    break;
                case 'growth':
                    growth = 85;
                    defensive = 15;
                    break;
                case 'high-growth':
                    growth = 100;
                    defensive = 0;
                    break;
                default:
                    growth = 50;
                    defensive = 50;
            }
            
            // Create chart
            allocationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Growth Assets', 'Defensive Assets'],
                    datasets: [{
                        data: [growth, defensive],
                        backgroundColor: ['#3498db', '#2ecc71'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Recommended Asset Allocation'
                        }
                    }
                }
            });
        }
        
        function generateRecommendations(currentAge, retirementAge, superBalance, contribution, partnerData, ttrData, downsizingData) {
            recommendationsList.innerHTML = '';
            
            // TTR recommendations
            if (currentAge >= 55 && !ttrData.planned) {
                recommendationsList.innerHTML += `
                    <div class="recommendation">
                        <h4>Consider Transition to Retirement</h4>
                        <p>You've reached preservation age (55+). A Transition to Retirement strategy could help you:</p>
                        <ul>
                            <li>Reduce working hours while maintaining income</li>
                            <li>Boost super through salary sacrifice with tax benefits</li>
                            <li>Gradually transition to full retirement</li>
                        </ul>
                    </div>
                `;
            }
            
            // Downsizing recommendations
            if (currentAge >= 55 && !downsizingData.planned) {
                recommendationsList.innerHTML += `
                    <div class="recommendation">
                        <h4>Evaluate Downsizing Potential</h4>
                        <p>As you approach retirement, consider whether downsizing could benefit your retirement plan:</p>
                        <ul>
                            <li>Unlock home equity for retirement income</li>
                            <li>Reduce maintenance costs and responsibilities</li>
                            <li>Make tax-advantaged downsizer contributions to super</li>
                        </ul>
                    </div>
                `;
            }
            
            // Asset allocation recommendations
            if (currentAge >= 50) {
                recommendationsList.innerHTML += `
                    <div class="recommendation">
                        <h4>Review Investment Strategy</h4>
                        <p>As you approach retirement, consider gradually shifting to a more conservative asset allocation:</p>
                        <ul>
                            <li>Reduce exposure to volatile growth assets</li>
                            <li>Increase defensive assets for stability</li>
                            <li>Consider the impact of sequence risk on your retirement savings</li>
                        </ul>
                    </div>
                `;
            }
            
            // Age Pension planning
            recommendationsList.innerHTML += `
                <div class="recommendation">
                    <h4>Age Pension Strategy</h4>
                    <p>Plan for Age Pension eligibility and optimize your assets:</p>
                    <ul>
                        <li>Understand asset and income test thresholds</li>
                        <li>Consider restructuring assets to maximize eligibility</li>
                        <li>Plan for the impact of the transfer balance cap ($1.9 million)</li>
                    </ul>
                </div>
            `;
            
            // General recommendations
            recommendationsList.innerHTML += `
                <div class="recommendation">
                    <h4>Ongoing Retirement Planning</h4>
                    <p>Continue to monitor and adjust your retirement strategy:</p>
                    <ul>
                        <li>Review your plan annually or when circumstances change</li>
                        <li>Consider consulting a qualified financial advisor</li>
                        <li>Stay informed about changes to super and pension rules</li>
                    </ul>
                </div>
            `;
        }
        
        function generateChart(currentAge, lifeExpectancy, returnRate, superBalance, contribution, partnerData) {
            const ctx = document.getElementById('retirement-chart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (retirementChart) {
                retirementChart.destroy();
            }
            
            // Prepare data for different retirement ages
            const labels = ['Age 55', 'Age 60', 'Age 65', 'Age 70'];
            const superData = [];
            const incomeData = [];
            
            // Calculate values for each retirement age
            for (let i = 0; i < labels.length; i++) {
                const scenarioAge = 55 + i * 5;
                const yearsToRetirement = scenarioAge - currentAge;
                
                // Calculate super at retirement
                let projectedSuper = superBalance;
                for (let j = 0; j < yearsToRetirement; j++) {
                    projectedSuper = projectedSuper * (1 + returnRate) + contribution;
                }
                
                // Add partner's super if applicable
                if (partnerData && partnerData.retirementAge <= scenarioAge) {
                    let partnerProjectedSuper = partnerData.super;
                    const partnerYearsToRetirement = scenarioAge - partnerData.age;
                    
                    for (let j = 0; j < partnerYearsToRetirement; j++) {
                        partnerProjectedSuper = partnerProjectedSuper * (1 + returnRate) + partnerData.contribution;
                    }
                    
                    projectedSuper += partnerProjectedSuper;
                }
                
                superData.push(projectedSuper);
                
                // Calculate retirement income (4% rule)
                const retirementIncome = projectedSuper * 0.04;
                incomeData.push(retirementIncome);
            }
            
            // Create chart
            retirementChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Projected Super Balance',
                            data: superData,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Annual Retirement Income',
                            data: incomeData,
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Retirement Projections by Age'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Utility function to format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-AU', {
                style: 'currency',
                currency: 'AUD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        // Save data to local storage
        saveBtn.addEventListener('click', saveData);
        
        function saveData() {
            const data = {
                currentAge: currentAge.value,
                retirementAge: retirementAge.value,
                lifeExpectancy: lifeExpectancy.value,
                inflation: inflation.value,
                investmentReturn: investmentReturn.value,
                currentSuper: currentSuper.value,
                annualContribution: annualContribution.value,
                salarySacrifice: salarySacrifice.value,
                currentIncome: currentIncome.value,
                currentExpenses: currentExpenses.value,
                retirementExpenses: retirementExpenses.value,
                healthcareCosts: healthcareCosts.value,
                hasPartner: hasPartnerCheckbox.checked,
                partnerAge: partnerAge.value,
                partnerRetirementAge: partnerRetirementAge.value,
                partnerKeepWorking: partnerKeepWorking.checked,
                partnerIncome: partnerIncome.value,
                partnerSuper: partnerSuper.value,
                partnerContribution: partnerContribution.value,
                considerDownsizing: considerDownsizingCheckbox.checked,
                downsizeValue: downsizeValue.value,
                downsizeAge: downsizeAge.value,
                considerTTR: considerTTRCheckbox.checked,
                ttrStartAge: ttrStartAge.value,
                ttrIncome: ttrIncome.value,
                ttrSalarySacrifice: ttrSalarySacrifice.value,
                riskProfile: riskProfile.value,
                currentAllocation: currentAllocation.value,
                investmentProperties: investmentProperties.value,
                primaryResidenceValue: primaryResidenceValue.value,
                otherAssets: otherAssets.value
            };
            
            localStorage.setItem('australianRetirementPlannerData', JSON.stringify(data));
            alert('Your retirement data has been saved locally!');
        }
        
        // Load data from local storage
        loadBtn.addEventListener('click', loadData);
        
        function loadData() {
            const savedData = localStorage.getItem('australianRetirementPlannerData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Load basic data
                currentAge.value = data.currentAge;
                retirementAge.value = data.retirementAge;
                lifeExpectancy.value = data.lifeExpectancy;
                inflation.value = data.inflation;
                investmentReturn.value = data.investmentReturn;
                currentSuper.value = data.currentSuper;
                annualContribution.value = data.annualContribution;
                salarySacrifice.value = data.salarySacrifice || 0;
                currentIncome.value = data.currentIncome;
                currentExpenses.value = data.currentExpenses;
                retirementExpenses.value = data.retirementExpenses;
                healthcareCosts.value = data.healthcareCosts;
                
                // Load partner data
                hasPartnerCheckbox.checked = data.hasPartner;
                if (data.hasPartner) {
                    partnerDetails.classList.remove('hidden');
                    partnerAge.value = data.partnerAge;
                    partnerRetirementAge.value = data.partnerRetirementAge;
                    partnerKeepWorking.checked = data.partnerKeepWorking;
                    partnerIncome.value = data.partnerIncome;
                    partnerSuper.value = data.partnerSuper;
                    partnerContribution.value = data.partnerContribution;
                }
                
                // Load strategy data
                considerDownsizingCheckbox.checked = data.considerDownsizing;
                if (data.considerDownsizing) {
                    downsizingDetails.classList.remove('hidden');
                    downsizeValue.value = data.downsizeValue;
                    downsizeAge.value = data.downsizeAge;
                }
                
                considerTTRCheckbox.checked = data.considerTTR;
                if (data.considerTTR) {
                    ttrDetails.classList.remove('hidden');
                    ttrStartAge.value = data.ttrStartAge;
                    ttrIncome.value = data.ttrIncome;
                    ttrSalarySacrifice.value = data.ttrSalarySacrifice;
                }
                
                riskProfile.value = data.riskProfile || 'moderate';
                currentAllocation.value = data.currentAllocation || 'balanced';
                
                // Load asset data
                investmentProperties.value = data.investmentProperties || 0;
                primaryResidenceValue.value = data.primaryResidenceValue || 0;
                otherAssets.value = data.otherAssets || 0;
                
                alert('Your saved retirement data has been loaded!');
                
                // Recalculate with loaded data
                calculateRetirement();
            } else {
                alert('No saved data found. Please save your data first.');
            }
        }
        
        // Export as PDF (simplified version)
        exportPdfBtn.addEventListener('click', () => {
            alert('In a full implementation, this would generate a PDF report. For now, use the print function.');
        });
        
        // Print plan
        printPlanBtn.addEventListener('click', () => {
            window.print();
        });
        
        // Initialize with sample calculation
        window.addEventListener('DOMContentLoaded', () => {
            calculateRetirement();
        });
    </script>
</body>
</html>
